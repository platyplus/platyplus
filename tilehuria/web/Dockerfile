# ! ########################################################################### ! #
# ! #|     THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY     |# ! #
# ! ########################################################################### ! #

FROM node:14-alpine as builder
RUN npm i lerna @quasar/cli -g --loglevel error
USER node
RUN mkdir /home/node/app
WORKDIR /home/node/app

COPY --chown=node:node package.json yarn.* lerna.json tsconfig.json tsconfig.build.json .eslintrc.js .eslintignore ./
#
COPY --chown=node:node packages/quasar-ts-lerna/package.json packages/quasar-ts-lerna/yarn.* packages/quasar-ts-lerna/
#
COPY --chown=node:node tilehuria/schema/package.json tilehuria/schema/yarn.* tilehuria/schema/
#
COPY --chown=node:node tilehuria/web/package.json tilehuria/web/yarn.* /home/node/app/tilehuria/web/

RUN yarn
#
COPY --chown=node:node packages/quasar-ts-lerna /home/node/app/packages/quasar-ts-lerna
#
COPY --chown=node:node tilehuria/schema /home/node/app/tilehuria/schema
#
COPY --chown=node:node tilehuria/web /home/node/app/tilehuria/web


RUN yarn build

FROM nginx:alpine
COPY --from=builder /home/node/app/tilehuria/web/dist/spa /usr/share/nginx/html
